// test.c
// Test program for salsa20 stream cipher.

#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>

#include "salsa20.h"

/* ----------------------------------------------------------------------------
	Local Prototypes
*/

static void print_bytes(uint8_t *bytes, size_t nbytes, size_t linesize);

/* ----------------------------------------------------------------------------
	Test
*/

int main(void) {
	uint8_t pt[64] = {
		0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF,
		0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF,
		0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF,
		0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF 
	};
	uint8_t key[32] = {
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 
	};
	uint8_t nonce[8] = {
		0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF 
	};
	uint8_t ct[64];
	uint8_t nt[64];

	// get our salsa20 on
	salsa20(ct, pt, 64, key, nonce);
	salsa20(nt, ct, 64, key, nonce);

	// how did we do?
	puts("plaintext in:");
	print_bytes(pt, 64, 16);
	puts("ciphertext:");
	print_bytes(ct, 64, 16);
	puts("plaintext out:");
	print_bytes(nt, 64, 16);

	return 0;
}

/* ----------------------------------------------------------------------------
	Local Prototypes
*/

// print nicely formatted bytes 
static void print_bytes(uint8_t *bytes, size_t nbytes, size_t linesize) {
	for (int i = 0; i < nbytes;) {
		for (int j = 0; (j < linesize) && (i < nbytes); j++, i++) 
			printf("%02x ", bytes[i]);
		putchar('\n');
	}
}

